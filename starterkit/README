============== -*- outline -*- ==============

   Renesas StarterKit (H3/M3/M3N) BSP ROM Writer

2021/09/02	Kuninori Morimoto <kuninori.morimoto.gx@renesas.com>
=============================================

-------------------------------
* What is Renesas StarterKit ?
-------------------------------

	See here, and search "R-Car Starter Kit"

		https://elinux.org/R-Car

-------------------------------
* Special Thanks
-------------------------------

	Special Thanks to Magnus Damm.
	The original code was his do_xls2 script

	Special Thanks to Shimoda-san, Goda-san.
	The original code was his TeraTerm Macro

-------------------------------
* Which OS are supported as Host ?
-------------------------------

	Linux
	Windows (TeraTerm)

-------------------------------
* How to get ROM ?
-------------------------------

	You have some informations / helpers

	Quick Start
		https://elinux.org/R-Car/Boards/H3SK#Quick_Start_How_To
		https://elinux.org/R-Car/Boards/M3SK#Quick_Start_How_To
		https://elinux.org/R-Car/Boards/M3NSK#Quick_Start_How_To

	Yocto Maker
		https://github.com/morimoto/renesas-yocto-maker
		https://gitlab.com/morimoto.kuninori/renesas-yocto-maker

		ex) In case of "H3" with "Yocto v5.1.0"

			> git clone https://github.com/morimoto/renesas-yocto-maker
			         or https://gitlab.com/morimoto.kuninori/renesas-yocto-maker
			> cd renesas-yocto-maker
			> yocto-make -b 5.1.0 h3ulcb
			> tar -jxf yocto-5.1.0-h3ulcb-xxxx-bin.tar.bz2

	Required ROM are almost like these

		bootparam_sa0.srec
		bl2-h3ulcb.srec
		cert_header_sa6.srec
		bl31-h3ulcb.srec
		tee-h3ulcb.srec
		u-boot-elf-h3ulcb.srec

-------------------------------
* How to know the connected tty ?
-------------------------------

	Connect your PC and StarterKit by USB cable, and check it by

		> dmesg | grep ttyUSB | tail
	   or
		> ls -l /dev/serial/by-id/*

-------------------------------
* WS1.x Boards on H3 is not supported
-------------------------------

	Please check your board at

		https://elinux.org/R-Car/Boards/H3SK#Hardware

-------------------------------
* Known Issue
-------------------------------

	renesas-bsp-rom-writer doesn't work correctly
	if USB cable is connected through USB Hub.
	We don't know why...

		NG: Host PC <--> USB Hub <--> StarterKit
		OK: Host PC <---------------> StarterKit

-------------------------------
* Preparation
-------------------------------

	You need "expect", "minicom", "git" command.
	If you are using Ubuntu, you can install these by

		> sudo apt install expect minicom git

	If you used previous version ROM Writer,
	maybe you need "make clean" for Linux, and make

		> cd ${renesas-bsp-rom-writer}/starterkit/linux
		> make clean
		> make

-------------------------------
* How to use it on Linux ?
-------------------------------

**  rom_writer

	rom_writer [a:y:h] <soc> <tty>

	goto ROM dir, and call rom_writer command from there.

	-y:	write Yocto
		5.5.0
		5.1.0
		4.1.0
		3.21.0
	-a:	write Android
		11_1.1
		11_1.0
		10_2.0
		10_1.2
	-h:	[Half-Auto] mode.
		[Full-Auto] is default.
	soc:	h3
		m3
		m3n
	tty:	/dev/ttyUSBx
		see above "How to know the connected tty ?"

	[Half-Auto]
	Need manual Dip-Switch setup.
	You need to use "Half-Auto" if your board doesn't have U-boot yet.
	                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
	[Full-Auto]
	No manual Dip-Switch setup is needed.
	You need run "make" at starterkit/linux once.
	You can use "Full-Auto" if your board already have U-boot.
	                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
	One note is that it looks stop after "please send !", but it is sending
	Mot to board. No worry. You need is just waiting.

	[Note]
	This command should be called from ROM dir which has Yocto/Android binarys.

	ex1)
	Write Yocto v5.1.0 to H3 Starterkit by Half-Auto mode.
	      ^^^^^^^^^^^^    ^^               ^^^^^^^^^

		> cd ${rom-dir}
		> ${renesas-bsp-rom-writer}/starterkit/linux/rom_writer -y 5.1.0 -h h3 /dev/ttyUSBx

	ex2)
	Write Android 10_2.0 to M3N Starterkit by Full-Auto mode.
	      ^^^^^^^^^^^^^^    ^^^               ^^^^^^^^^

		> cd ${renesas-bsp-rom-writer}/starterkit/linux/
		> make
		> cd ${rom-dir}
		> ${renesas-bsp-rom-writer}/starterkit/linux/rom_writer -a 10_2.0 m3n /dev/ttyUSBx

**  android_setup

	android_setup <mac> <tty>

	mac:	Ether Mac address
		Renesas board has it on Ether socket.
		ex)
			12:34:56:78:9a:bc
	tty:	/dev/ttyUSBx
		see above "How to know the connected tty ?"

	[Note]
	This command should be called from ROM dir which has Android binarys.
	This command uses "sudo". you need belong to sudo group.
	During this command, Ubuntu might has below message box. But you can ignore it.

		-----------------------------------
		Unable to mount USB download gadget
		can't open MTP device xxx
		-----------------------------------

	ex)
		> cd ${android-rom-dir}
		> ${renesas-bsp-rom-writer}/starterkit/linux/android_setup 12:34:56:78:9a:bc /dev/ttyUSBx

-------------------------------
* How to use it on Windows ?
-------------------------------

**  Preparation

	You need "TeraTerm". See here and get it

		https://ttssh2.osdn.jp/index.html.ja
		https://ttssh2.osdn.jp/index.html.en

	You need mot file if use "Full-Auto" mode, but Windows user can't create it by yourself.
	Please get it from Linux user, and set it below.

	Linux:
		${renesas-bsp-rom-writer}/starterkit/linux/script/flash_writer/AArch32_output/AArch32_Flash_writer_SCIF_DUMMY_CERT_E6300400_ULCB.mot
	Windows:
		${renesas-bsp-rom-writer}/starterkit/AArch32_Flash_writer_SCIF_DUMMY_CERT_E6300400_ULCB.mot

**  Usage

	You need to use "Half-Auto" if your board doesn't have U-boot yet.
	                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
	You can use "Full-Auto" if your board have U-boot.
	                           ^^^^^^^^^^^^^^^^^^^^^^

	- Start TeraTerm
	- Open Macro via
		[Menu] - [Control] - [Macro]
		${renesas-bsp-rom-writer}/starterkit/windows/rom_writer.ttl
	- Follow the Question
	  Then, you need to select ROM folder

-------------------------------
* FAQ
-------------------------------
**  It doesn't work for me ?

	Does your Renesas StarterKit U-boot indicate prompt ("=>") and is waiting command ?
	renesas-bsp-rom-writer is waiting prompt, and will send the command.
	Your U-Boot need to wait the command by prompt ("=>").

**  It stops after "please send !" ?

	No worry !
	It is sending "flash writer" to the board, and it takes a time.
	You need to is just "waiting patiently" :)
